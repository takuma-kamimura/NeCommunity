<!-- app/views/maps/index.html.erb -->
<h1>動物病院検索結果</h1>
<%= form_tag(maps_path, method: :get) do %>
  <%= label_tag :location, "検索する場所:" %>
  <%= text_field_tag :location, params[:location] %>
  <%= submit_tag "検索" %>
<% end %>

<% if @search_results.present? %>
  <h2>検索結果</h2>
  <%= raw @search_results %> <!-- rawメソッドを使用してHTMLがエスケープされないようにします -->
<% else %>
  <p>検索結果はありません。</p>
<% end %>

<h2>gmap</h2>

<input id="address" type="textbox" value="GeekSalon">
<input type="button" value="Encode" onclick="codeAddress()">
<!-- 下の2行を追加 -->
<div id="display">何かが表示される、、、、！</div>
<div id='map'></div>

<style>
  #map {
    height: 600px;
    width: 600px;
  }
</style>

<script>
  let map;
  let geocoder;
  const display = document.getElementById('display');

  function initMap() {
    geocoder = new google.maps.Geocoder();

    map = new google.maps.Map(document.getElementById('map'), {
      center: { lat: 40.7828, lng: -73.9653 },
      zoom: 12,
    });
  }

  function codeAddress() {
    let inputAddress = document.getElementById('address').value;

    geocoder.geocode({ 'address': inputAddress }, function (results, status) {
      if (status == 'OK') {
        map.setCenter(results[0].geometry.location);
        var marker = new google.maps.Marker({
          map: map,
          position: results[0].geometry.location
        });

        // 下の3行を追加
        display.textContent = "検索結果：" + results[0].geometry.location;
        // マーカーの情報ウィンドウを追加
        var infowindow = new google.maps.InfoWindow({
          content: "<b>" + results[0].formatted_address + "</b>"
        });
        infowindow.open(map, marker);
      } else {
        alert('該当する結果がありませんでした：' + status);
      }
    });
  }
</script>
<script src="https://maps.googleapis.com/maps/api/js?key=<%= ENV['YOUR_API_KEY'] %>&callback=initMap" async defer></script>